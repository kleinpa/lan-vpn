load("@rules_foreign_cc//foreign_cc:defs.bzl", "cmake")

filegroup(name = "all", srcs = glob(["**"]))

cmake(
    name = "mbedtls",
    lib_source = ":all",
    visibility = ["//visibility:public"],
    cache_entries =
        {"ENABLE_TESTING":
         "Off"},  # avoid python and perl
    out_static_libs = [
        "libmbedtls.a",
        "libmbedcrypto.a",
        "libmbedx509.a",
    ],
    out_binaries = [
        "aescrypt2",
        "benchmark",
        "cert_app",
        "cert_req",
        "cert_write",
        "crl_app",
        "crypt_and_hash",
        "crypto_examples",
        "dh_client",
        "dh_genprime",
        "dh_server",
        "dtls_client",
        "dtls_server",
        "ecdh_curve25519",
        "ecdsa",
        "gen_entropy",
        "gen_key",
        "gen_random_ctr_drbg",
        "gen_random_havege",
        "generic_sum",
        "hello",
        "key_app",
        "key_app_writer",
        "key_ladder_demo",
        "key_ladder_demo.sh",
        "mini_client",
        "mpi_demo",
        "pem2der",
        "pk_decrypt",
        "pk_encrypt",
        "pk_sign",
        "pk_verify",
        "psa_constant_names",
        "query_compile_time_config",
        "req_app",
        "rsa_decrypt",
        "rsa_encrypt",
        "rsa_genkey",
        "rsa_sign",
        "rsa_sign_pss",
        "rsa_verify",
        "rsa_verify_pss",
        "selftest",
        "ssl_client1",
        "ssl_client2",
        "ssl_context_info",
        "ssl_fork_server",
        "ssl_mail_client",
        "ssl_pthread_server",
        "ssl_server",
        "ssl_server2",
        "strerror",
        "udp_proxy",
        "zeroize",
    ],
)
